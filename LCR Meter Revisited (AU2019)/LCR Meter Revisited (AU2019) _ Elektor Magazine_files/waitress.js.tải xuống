function throttle(e,t,i){var n,a,r,o=null,s=0;i||(i={});var d=function(){s=i.leading===!1?0:Date.now(),o=null,r=e.apply(n,a),o||(n=a=null)};return function(){var l=Date.now();s||i.leading!==!1||(s=l);var u=t-(l-s);return n=this,a=arguments,u<=0||u>t?(o&&(clearTimeout(o),o=null),s=l,r=e.apply(n,a),o||(n=a=null)):o||i.trailing===!1||(o=setTimeout(d,u)),r}}function initWaitress(){"undefined"!=typeof google&&google.loader&&null!=google.loader.ClientLocation&&(latitude=google.loader.ClientLocation.latitude,longitude=google.loader.ClientLocation.longitude,country=google.loader.ClientLocation.address.country_code);var e=jQuery(".advertisement"),t=e.length;for(i=0;i<t;i++)jQuery(e[i]).attr("data-identifier","advertisement"+i);e.length>0&&cook(e,!1)}function hasBlocker(){return"undefined"==typeof canRunAds}function cook(e,t){items=new Array,e.each(function(e,t){items.push({dish:jQuery(this).attr("ad")?jQuery(this).attr("ad"):jQuery(this).attr("data-ad"),banner:jQuery(this).attr("banner")?jQuery(this).attr("banner"):jQuery(this).attr("data-banner"),identifier:jQuery(t).attr("data-identifier")})}),jQuery.ajax({type:"GET",url:"https://www.elektormagazine.com/waitress/serve?__callback=waitress",dataType:"jsonp",data:{dishes:items,mobile:isMobile(),lat:latitude,lng:longitude,country:country,hasBlocker:hasBlocker()},success:function(e){if(null!==e.data&&""!==e.data){var i=new Array;dataLength=e.data.length;for(var n=0;n<dataLength;n++)void 0!=e.data[n].data&&e.data[n].data.isPreview&&i.push(e.data[n].data.preview),serve(e.data[n],t);if(jQuery(".ad ~ .advertisement:empty").prev().hide(),i.length>0){for(var a='<div style="position:fixed;bottom:0;left:0;right:0;width:100%;background:#364150;font-family:Verdana;color: #fff;padding-bottom:20px;" id="BannerPreviewContainer"><a href="javascript: jQuery.ajax({ type: \'GET\', url: \'https://www.elektormagazine.com/portal/banner/preview/destroy\', dataType: \'jsonp\', success: function(response){ jQuery(\'#BannerPreviewContainer\').remove();}});" style="float: right;color: #fff;margin: 10px;font-size: 11px;">Leave preview mode</a><h2 style="margin-left:20px;">Banner preview</h2><div style="margin-left:20px;font-size:13px;">The following banners are shown in preview mode:<ul style="margin-left: 40px;margin-top:6px;">',n=0;n<i.length;n++)a+='<li style="line-height:22px;"><b>'+i[n].banner+"</b> in zone <b>"+i[n].zone+"</b></li>";a+="</ul></div></div>",jQuery("body").append(a)}setTimeout(function(){initImpressionTracking(e.data)},1e3),window.onscroll=function(){impress()},impress()}}})}function serve(e,t){if(null!==e&&void 0!==e.data&&null!==e.data&&"-1"!==e.data){var i=e.data,n=jQuery('.advertisement[data-identifier="'+e.identifier+'"]'),a="";if(i.showTillClose&&(a='<div class="close-banner" onclick="closeAd('+i.id+",'"+e.identifier+'\');" style="cursor:pointer;position: absolute;right: -14px;top: -24px;margin-top: 10px;margin-left: -22px;width: 75px;text-align: right;font-family: Arial;z-index: 10;">X</div>'),i.isAnchor){var r=localStorage.getItem("banner.state:"+i.id);n.addClass("banner-hidden"),n.html('<div bpzId="'+e.data.id+'" class="_waitress ident'+(""+Math.random(0,100)).substring(2,7)+" "+(i.isInternalBanner?"internalBanner":"externalBanner")+'"><div class="banner-header"><div class="banner-header-title">'+i.title+'</div><div class="banner-header-toggle"><div class="banner-toggle-icon" onclick="toggleAd('+i.id+",'"+e.dish+'\');"></div></div></div><div class="banner-content">'+i.dish+"</div></div>"),setTimeout(function(){"0"===r&&n.addClass("banner-collapsed"),n.removeClass("banner-hidden")},1)}else t?(n.append("<div bpzId='"+e.data.id+"' class='_waitress' style='display:none;"+(""!=a?"position: relative;":"")+"'>"+a+i.dish+"</div>"),n.children().first().slideUp("slow",function(){n.children().first().remove(),n.children().first().slideDown("slow")})):n.html('<div bpzId="'+e.data.id+'" style="'+(""!=a?"position: relative;":"")+'" class="_waitress ident'+(""+Math.random(0,100)).substring(2,7)+" "+(i.isInternalBanner?"internalBanner":"externalBanner")+'">'+a+i.dish+"</div>");e.ad=n[0],e.viewed=!1,e.showing=null}}function closeAd(e,t){jQuery('.advertisement[data-identifier="'+t+'"]').remove();try{positionMenu()}catch(i){}jQuery.ajax({type:"GET",url:"https://www.elektormagazine.com/waitress/close/"+e})}function toggleAd(e,t){var i=jQuery('.advertisement[ad="'+t+'"]');i.toggleClass("banner-collapsed"),localStorage.setItem("banner.state:"+e,i.hasClass("banner-collapsed")?0:1)}function initImpressionTracking(e){e=e.filter(function(e){return"undefined"!=typeof e.ad}),checkAdsOnScreen(e,!1),w.on("scroll resize",throttle(function(){checkAdsOnScreen(e,!0)},100))}function checkAdsOnScreen(e,t){var i=w.height(),n=w.width();e.forEach(function(e){var a=e.ad.getBoundingClientRect();!e.viewed&&isVisible(i,n,a)?(null===e.showing&&t&&(e.showing=new Date,e.timer=setTimeout(function(){checkAdOnScreen(e)},impressionTimeout)),(new Date-e.showing>=impressionTimeout||t===!1)&&(e.viewed=!0,viewAd(e))):(clearTimeout(e.timer),e.showing=null,e.timer=null)})}function checkAdOnScreen(e){var t=w.height(),i=w.width(),n=e.ad.getBoundingClientRect();!e.viewed&&isVisible(t,i,n)&&(clearTimeout(e.timer),e.viewed=!0,viewAd(e))}function viewAd(e){jQuery.ajax({type:"GET",url:"https://www.elektormagazine.com/waitress/impression/"+e.data.id,dataType:"jsonp"})}function isVisible(e,t,i){return i.left>-(i.width/2)&&i.top>-(i.height/2)&&i.bottom<e+i.height/2&&i.right<t+i.width/2}function isMobile(){return window.innerWidth<=800}function _bannerDisplayer(){$(".__zone").hide(),$(".advertisement").css("border","3px red dotted").css("padding","10px 0").each(function(){$(this).append('<span class="__zone">Zone:'+($(this).attr("ad")?$(this).attr("ad"):$(this).attr("data-ad"))+"</span>")})}function impress(){$("._waitress").each(function(){var e=window.pageYOffset+window.innerHeight,t=$(this).parent().offset().top;!ads.includes($(this).attr("bpzId"))&&t<e&&(ads.push($(this).attr("bpzId")),jQuery.ajax({type:"PUT",url:"https://www.elektormagazine.com/waitress/observation/"+$(this).attr("bpzId"),dataType:"jsonp"}))})}var latitude=1,longitude=1,country="",w=$(window),impressionTimeout=1e3,ads=[];document.addEventListener("DOMContentLoaded",function(){initWaitress()});